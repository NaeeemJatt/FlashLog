<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>FlashLog - Advanced Analytics Dashboard</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Chart.js for visualizations -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Chart.js plugins for enhanced features -->
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>
    
    <style>
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .fade-in-up {
            animation: fadeInUp 0.6s ease-out forwards;
        }
        
        .fade-in-up-delay-1 {
            animation: fadeInUp 0.6s ease-out 0.1s forwards;
            opacity: 0;
        }
        
        .fade-in-up-delay-2 {
            animation: fadeInUp 0.6s ease-out 0.2s forwards;
            opacity: 0;
        }
        
        .fade-in-up-delay-3 {
            animation: fadeInUp 0.6s ease-out 0.3s forwards;
            opacity: 0;
        }
        
        .chart-container {
            position: relative;
            height: 300px;
            width: 100%;
        }
        
        .metric-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 12px;
            padding: 1.5rem;
            text-align: center;
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
            transition: all 0.3s ease;
        }
        
        .metric-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(102, 126, 234, 0.4);
        }
        
        .chart-panel {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            border: 1px solid #e5e7eb;
            transition: all 0.3s ease;
            overflow: hidden;
        }
        
        .chart-panel:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }
        
        .chart-header {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            padding: 1rem 1.5rem;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            justify-content: between;
            align-items: center;
        }
        
        .chart-controls {
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }
        
        .chart-type-selector {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .chart-type-selector:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }
        
        .chart-type-selector:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.3);
        }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .data-table th,
        .data-table td {
            padding: 0.75rem;
            text-align: left;
            border-bottom: 1px solid #e5e7eb;
        }
        
        .data-table th {
            background: #f8fafc;
            font-weight: 600;
            color: #374151;
        }
        
        .data-table tr:hover {
            background: #f9fafb;
        }
        
        .loading-spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .metric-value {
            font-size: 2.5rem;
            font-weight: 700;
            line-height: 1;
            margin-bottom: 0.5rem;
        }
        
        .metric-label {
            font-size: 0.875rem;
            opacity: 0.9;
            font-weight: 500;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Enhanced 3D Navbar -->
    <nav class="fixed top-0 left-0 w-full z-50 bg-white/95 backdrop-blur-md border-b border-gray-200/50 shadow-lg shadow-gray-900/10">
        <div class="max-w-7xl mx-auto flex items-center justify-between h-16 px-6">
            <!-- Logo Section -->
            <div class="flex items-center gap-3">
                <div class="relative group">
                    <div class="font-bold text-xl text-gray-900 bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent">
                        FlashLog Analytics
                    </div>
                    <div class="absolute -bottom-1 left-0 w-0 h-0.5 bg-gradient-to-r from-blue-600 to-purple-600 transition-all duration-300 group-hover:w-full"></div>
                </div>
            </div>
            
            <!-- Navigation Items -->
            <div class="flex items-center gap-4">
                <!-- Back to Main Dashboard Button -->
                <a href="{{ url_for('main.index') }}" class="inline-flex items-center px-4 py-2 bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 text-white text-sm font-medium rounded-lg shadow-lg hover:shadow-xl transition-all duration-200 transform hover:scale-105">
                    <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
                    </svg>
                    Main Dashboard
                </a>
                
                <!-- User Menu -->
                <div class="relative group">
                    <div class="flex items-center gap-3 px-4 py-2 bg-gray-100/50 rounded-lg cursor-pointer hover:bg-gray-200/50 transition-all duration-200">
                        <div class="w-8 h-8 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full flex items-center justify-center text-white font-semibold text-sm">
                            {{ session.username[0].upper() }}
                        </div>
                        <span class="text-sm font-medium text-gray-700">{{ session.username }}</span>
                        <svg class="w-4 h-4 text-gray-500 transition-transform duration-200 group-hover:rotate-180" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                        </svg>
                    </div>
                    
                    <!-- Dropdown Menu -->
                    <div class="absolute right-0 top-full mt-2 w-48 bg-white rounded-lg shadow-xl border border-gray-200 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 transform origin-top-right scale-95 group-hover:scale-100">
                        <div class="py-2">
                            <a href="{{ url_for('auth.profile') }}" class="flex items-center px-4 py-3 text-sm text-gray-700 hover:bg-gray-100 transition-colors">
                                <svg class="w-4 h-4 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                                </svg>
                                Profile & Account
                            </a>
                            <a href="{{ url_for('auth.change_password') }}" class="flex items-center px-4 py-3 text-sm text-gray-700 hover:bg-gray-100 transition-colors">
                                <svg class="w-4 h-4 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z"></path>
                                </svg>
                                Change Password
                            </a>
                            <hr class="my-2 border-gray-200">
                            <a href="{{ url_for('auth.logout') }}" class="flex items-center px-4 py-3 text-sm text-blue-600 hover:bg-blue-50 transition-colors">
                                <svg class="w-4 h-4 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path>
                                </svg>
                                Logout
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <main class="pt-20 pb-6 px-6">
        <div class="max-w-7xl mx-auto">
            <!-- Header -->
            <div class="text-center mb-8 fade-in-up">
                <h1 class="text-4xl font-bold text-gray-900 mb-2">Advanced Analytics Dashboard</h1>
                <p class="text-gray-600 text-lg">Comprehensive log analysis with interactive visualizations</p>
                <div class="mt-4 text-sm text-gray-500">
                    Analysis ID: {{ analysis.id }} | Created: {{ analysis.created_at[:19] if analysis.created_at else 'N/A' }}
                </div>
            </div>

            <!-- Top Row: Key Metrics -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8 fade-in-up-delay-1">
                <div class="metric-card">
                    <div class="metric-value">{{ dashboard_data.summary.total_logs }}</div>
                    <div class="metric-label">Total Events</div>
                </div>

                <div class="metric-card">
                    <div class="metric-value">{{ dashboard_data.summary.normal_count }}</div>
                    <div class="metric-label">Normal Events</div>
                </div>

                <div class="metric-card">
                    <div class="metric-value">{{ dashboard_data.summary.anomaly_count }}</div>
                    <div class="metric-label">Anomalies Detected</div>
                </div>

                <div class="metric-card">
                    <div class="metric-value">{{ dashboard_data.summary.anomaly_percentage }}%</div>
                    <div class="metric-label">Anomaly Rate</div>
                </div>
            </div>

            <!-- Middle Row: Main Charts -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8 fade-in-up-delay-2">
                <!-- Anomaly Distribution Chart -->
                <div class="chart-panel">
                    <div class="chart-header">
                        <h3 class="text-lg font-semibold text-gray-900">Anomaly Distribution</h3>
                        <div class="chart-controls">
                            <select class="chart-type-selector" onchange="changeChartType('anomaly', this.value)">
                                <option value="doughnut">Donut</option>
                                <option value="pie">Pie</option>
                                <option value="bar">Bar</option>
                                <option value="line">Line</option>
                            </select>
                        </div>
                    </div>
                    <div class="p-6">
                        <div class="chart-container">
                            <canvas id="anomalyChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Error Levels Chart -->
                {% if dashboard_data.pattern_data.error_levels %}
                <div class="chart-panel">
                    <div class="chart-header">
                        <h3 class="text-lg font-semibold text-gray-900">TOP 10 Error Levels</h3>
                        <div class="chart-controls">
                            <select class="chart-type-selector" onchange="changeChartType('error', this.value)">
                                <option value="pie">Pie</option>
                                <option value="doughnut">Donut</option>
                                <option value="bar">Bar</option>
                                <option value="line">Line</option>
                            </select>
                        </div>
                    </div>
                    <div class="p-6">
                        <div class="chart-container">
                            <canvas id="errorChart"></canvas>
                        </div>
                    </div>
                </div>
                {% endif %}

                <!-- Hourly Distribution Chart -->
                {% if dashboard_data.time_data.hourly_distribution %}
                <div class="chart-panel">
                    <div class="chart-header">
                        <h3 class="text-lg font-semibold text-gray-900">Events Over Time</h3>
                        <div class="chart-controls">
                            <select class="chart-type-selector" onchange="changeChartType('hourly', this.value)">
                                <option value="bar">Bar</option>
                                <option value="line">Line</option>
                                <option value="area">Area</option>
                                <option value="pie">Pie</option>
                            </select>
                        </div>
                    </div>
                    <div class="p-6">
                        <div class="chart-container">
                            <canvas id="hourlyChart"></canvas>
                        </div>
                    </div>
                </div>
                {% endif %}

                <!-- Top Words Chart -->
                {% if dashboard_data.pattern_data.top_words %}
                <div class="chart-panel">
                    <div class="chart-header">
                        <h3 class="text-lg font-semibold text-gray-900">TOP 10 Common Words</h3>
                        <div class="chart-controls">
                            <select class="chart-type-selector" onchange="changeChartType('words', this.value)">
                                <option value="horizontalBar">Horizontal Bar</option>
                                <option value="bar">Vertical Bar</option>
                                <option value="line">Line</option>
                                <option value="pie">Pie</option>
                            </select>
                        </div>
                    </div>
                    <div class="p-6">
                        <div class="chart-container">
                            <canvas id="wordsChart"></canvas>
                        </div>
                    </div>
                </div>
                {% endif %}
            </div>

            <!-- Bottom Row: Additional Analytics -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8 fade-in-up-delay-3">
                <!-- Log Severity Chart -->
                <div class="chart-panel">
                    <div class="chart-header">
                        <h3 class="text-lg font-semibold text-gray-900">Log Severity Analysis</h3>
                        <div class="chart-controls">
                            <select class="chart-type-selector" onchange="changeChartType('severity', this.value)">
                                <option value="pie">Pie</option>
                                <option value="doughnut">Donut</option>
                                <option value="bar">Bar</option>
                                <option value="line">Line</option>
                            </select>
                        </div>
                    </div>
                    <div class="p-6">
                        <div class="chart-container">
                            <canvas id="severityChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Anomaly Timeline Chart -->
                <div class="chart-panel">
                    <div class="chart-header">
                        <h3 class="text-lg font-semibold text-gray-900">Anomaly Timeline</h3>
                        <div class="chart-controls">
                            <select class="chart-type-selector" onchange="changeChartType('timeline', this.value)">
                                <option value="line">Line</option>
                                <option value="area">Area</option>
                                <option value="bar">Bar</option>
                                <option value="scatter">Scatter</option>
                            </select>
                        </div>
                    </div>
                    <div class="p-6">
                        <div class="chart-container">
                            <canvas id="timelineChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Data Table Row -->
            <div class="mb-8 fade-in-up-delay-3">
                <div class="chart-panel">
                    <div class="chart-header">
                        <h3 class="text-lg font-semibold text-gray-900">Detailed Event Analysis</h3>
                    </div>
                    <div class="p-6">
                        <div class="overflow-x-auto">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Event Type</th>
                                        <th>Count</th>
                                        <th>Percentage</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>Normal Events</td>
                                        <td>{{ dashboard_data.summary.normal_count }}</td>
                                        <td>{{ (dashboard_data.summary.normal_count / dashboard_data.summary.total_logs * 100) | round(2) }}%</td>
                                        <td><span class="px-2 py-1 bg-green-100 text-green-800 rounded-full text-xs">Normal</span></td>
                                    </tr>
                                    <tr>
                                        <td>Anomalies</td>
                                        <td>{{ dashboard_data.summary.anomaly_count }}</td>
                                        <td>{{ dashboard_data.summary.anomaly_percentage }}%</td>
                                        <td><span class="px-2 py-1 bg-red-100 text-red-800 rounded-full text-xs">Anomaly</span></td>
                                    </tr>
                                    {% if dashboard_data.pattern_data.error_levels %}
                                    {% for level, count in dashboard_data.pattern_data.error_levels.items() %}
                                    <tr>
                                        <td>{{ level }}</td>
                                        <td>{{ count }}</td>
                                        <td>{{ (count / dashboard_data.summary.total_logs * 100) | round(2) }}%</td>
                                        <td>
                                            {% if level == 'ERROR' or level == 'CRITICAL' %}
                                            <span class="px-2 py-1 bg-red-100 text-red-800 rounded-full text-xs">High</span>
                                            {% elif level == 'WARNING' %}
                                            <span class="px-2 py-1 bg-yellow-100 text-yellow-800 rounded-full text-xs">Medium</span>
                                            {% else %}
                                            <span class="px-2 py-1 bg-blue-100 text-blue-800 rounded-full text-xs">Low</span>
                                            {% endif %}
                                        </td>
                                    </tr>
                                    {% endfor %}
                                    {% endif %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Insights and Recommendations -->
            <div class="mb-8 fade-in-up-delay-3">
                <h2 class="text-2xl font-bold text-gray-900 mb-6">Analysis Insights & Recommendations</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    {% for insight in dashboard_data.anomaly_insights %}
                    <div class="chart-panel">
                        <div class="p-6">
                            <div class="flex items-start">
                                <div class="flex-shrink-0">
                                    {% if insight.type == 'success' %}
                                    <div class="p-2 rounded-full bg-green-100">
                                        <svg class="w-5 h-5 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                        </svg>
                                    </div>
                                    {% elif insight.type == 'warning' %}
                                    <div class="p-2 rounded-full bg-yellow-100">
                                        <svg class="w-5 h-5 text-yellow-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
                                        </svg>
                                    </div>
                                    {% elif insight.type == 'alert' %}
                                    <div class="p-2 rounded-full bg-red-100">
                                        <svg class="w-5 h-5 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                        </svg>
                                    </div>
                                    {% else %}
                                    <div class="p-2 rounded-full bg-blue-100">
                                        <svg class="w-5 h-5 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                        </svg>
                                    </div>
                                    {% endif %}
                                </div>
                                <div class="ml-4 flex-1">
                                    <h3 class="text-lg font-semibold text-gray-900 mb-2">{{ insight.title }}</h3>
                                    <p class="text-gray-600 mb-3">{{ insight.description }}</p>
                                    <div class="bg-gray-50 rounded-lg p-3">
                                        <p class="text-sm font-medium text-gray-900 mb-1">Recommendation:</p>
                                        <p class="text-sm text-gray-600">{{ insight.recommendation }}</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="flex flex-wrap gap-4 justify-center fade-in-up-delay-3">
                <a href="{{ url_for('main.analyzed_logs') }}" class="inline-flex items-center px-6 py-3 bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 text-white font-medium rounded-lg shadow-lg hover:shadow-xl transition-all duration-200 transform hover:scale-105">
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                    </svg>
                    View Detailed Results
                </a>
                
                <a href="{{ url_for('main.index') }}" class="inline-flex items-center px-6 py-3 bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 text-white font-medium rounded-lg shadow-lg hover:shadow-xl transition-all duration-200 transform hover:scale-105">
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                    </svg>
                    New Analysis
                </a>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-white mt-12">
        <div class="max-w-7xl mx-auto px-6 py-6">
            <div class="flex justify-between items-center">
                <div class="text-sm text-gray-600">
                    Created by <span class="font-semibold text-gray-900">Naeem Jatt</span>
                </div>
                <div class="flex items-center gap-1">
                    <a href="https://github.com/NaeeemJatt" target="_blank" 
                       class="flex items-center gap-2 text-sm text-gray-600 hover:text-gray-900 transition-colors">
                        <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
                        </svg>
                        GitHub
                    </a>
                    <a href="https://naeemashiq.com/" target="_blank" 
                       class="flex items-center gap-2 text-sm text-gray-600 hover:text-gray-900 transition-colors">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9v-9m0-9v9m0-9c-5 0-9 4-9 9s4 9 9 9"/>
                        </svg>
                        Portfolio
                    </a>
                </div>
            </div>
        </div>
    </footer>

    <script>
        // Check if Chart.js is loaded
        if (typeof Chart === 'undefined') {
            console.error('âŒ Chart.js is not loaded! Please check the CDN link.');
            document.addEventListener('DOMContentLoaded', function() {
                // Show error message on dashboard
                const chartContainers = document.querySelectorAll('.chart-container');
                chartContainers.forEach(container => {
                    container.innerHTML = '<div class="flex items-center justify-center h-full text-red-500"><p>Chart.js failed to load. Please refresh the page.</p></div>';
                });
            });
        }
        
        // Global chart instances
        let charts = {};
        
        // Chart.js configuration with enhanced colors
        const chartColors = {
            primary: '#667eea',
            secondary: '#764ba2',
            success: '#10b981',
            danger: '#ef4444',
            warning: '#f59e0b',
            info: '#06b6d4',
            light: '#6b7280',
            dark: '#374151',
            purple: '#8b5cf6',
            pink: '#ec4899',
            indigo: '#6366f1',
            teal: '#14b8a6'
        };

        // Enhanced color palette for charts
        const colorPalette = [
            chartColors.primary,
            chartColors.secondary,
            chartColors.success,
            chartColors.danger,
            chartColors.warning,
            chartColors.info,
            chartColors.purple,
            chartColors.pink,
            chartColors.indigo,
            chartColors.teal
        ];

        // Common chart options
        const commonOptions = {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'bottom',
                    labels: {
                        color: '#374151',
                        padding: 20,
                        usePointStyle: true,
                        font: {
                            size: 12
                        }
                    }
                },
                tooltip: {
                    backgroundColor: '#ffffff',
                    titleColor: '#374151',
                    bodyColor: '#374151',
                    borderColor: '#e5e7eb',
                    borderWidth: 1,
                    cornerRadius: 8,
                    displayColors: true
                }
            }
        };

        // Chart type switching function
        function changeChartType(chartId, newType) {
            if (charts[chartId]) {
                charts[chartId].destroy();
            }
            
            const canvas = document.getElementById(chartId + 'Chart');
            const ctx = canvas.getContext('2d');
            
            let chartConfig = getChartConfig(chartId, newType);
            
            charts[chartId] = new Chart(ctx, chartConfig);
        }

        // Get chart configuration based on type
        function getChartConfig(chartId, chartType) {
            const baseConfig = {
                type: chartType === 'horizontalBar' ? 'bar' : chartType,
                data: getChartData(chartId),
                options: { ...commonOptions }
            };

            // Special configurations for different chart types
            if (chartType === 'horizontalBar') {
                baseConfig.options.indexAxis = 'y';
            }

            if (chartType === 'area') {
                baseConfig.type = 'line';
                baseConfig.data.datasets.forEach(dataset => {
                    dataset.fill = true;
                    dataset.tension = 0.4;
                });
            }

            if (chartType === 'scatter') {
                baseConfig.type = 'scatter';
                baseConfig.options.scales = {
                    x: {
                        type: 'linear',
                        position: 'bottom',
                        grid: { color: '#e5e7eb' },
                        ticks: { color: '#374151' }
                    },
                    y: {
                        grid: { color: '#e5e7eb' },
                        ticks: { color: '#374151' }
                    }
                };
            }

            return baseConfig;
        }

        // Get chart data based on chart ID
        function getChartData(chartId) {
            switch(chartId) {
                case 'anomaly':
                    return {
                        labels: ['Normal Events', 'Anomalies'],
                        datasets: [{
                            data: [{{ dashboard_data.summary.normal_count }}, {{ dashboard_data.summary.anomaly_count }}],
                            backgroundColor: [chartColors.success, chartColors.danger],
                            borderWidth: 0,
                            hoverOffset: 4
                        }]
                    };
                
                case 'error':
                    const errorData = {{ dashboard_data.pattern_data.error_levels | tojson if dashboard_data.pattern_data and dashboard_data.pattern_data.error_levels else '{}' }};
                    if (Object.keys(errorData).length === 0) {
                        return {
                            labels: ['No Error Data'],
                            datasets: [{
                                label: 'Count',
                                data: [1],
                                backgroundColor: [chartColors.light],
                                borderRadius: 6,
                                borderSkipped: false
                            }]
                        };
                    }
                    return {
                        labels: Object.keys(errorData),
                        datasets: [{
                            label: 'Count',
                            data: Object.values(errorData),
                            backgroundColor: colorPalette.slice(0, Object.keys(errorData).length),
                            borderRadius: 6,
                            borderSkipped: false
                        }]
                    };
                
                case 'hourly':
                    const hourlyData = {{ dashboard_data.time_data.hourly_distribution | tojson if dashboard_data.time_data and dashboard_data.time_data.hourly_distribution else '{}' }};
                    const hourlyAnomalies = {{ dashboard_data.time_data.hourly_anomalies | tojson if dashboard_data.time_data and dashboard_data.time_data.hourly_anomalies else '{}' }};
                    const hours = Array.from({length: 24}, (_, i) => i);
                    const hourlyValues = hours.map(hour => hourlyData[hour] || 0);
                    const anomalyValues = hours.map(hour => hourlyAnomalies[hour] || 0);
                    
                    return {
                        labels: hours.map(h => `${h}:00`),
                        datasets: [{
                            label: 'Total Events',
                            data: hourlyValues,
                            borderColor: chartColors.primary,
                            backgroundColor: chartColors.primary + '20',
                            tension: 0.4,
                            fill: false
                        }, {
                            label: 'Anomalies',
                            data: anomalyValues,
                            borderColor: chartColors.danger,
                            backgroundColor: chartColors.danger + '20',
                            tension: 0.4,
                            fill: false
                        }]
                    };
                
                case 'words':
                    const wordsData = {{ dashboard_data.pattern_data.top_words | tojson if dashboard_data.pattern_data and dashboard_data.pattern_data.top_words else '{}' }};
                    if (Object.keys(wordsData).length === 0) {
                        return {
                            labels: ['No Word Data'],
                            datasets: [{
                                label: 'Frequency',
                                data: [1],
                                backgroundColor: chartColors.light,
                                borderRadius: 6
                            }]
                        };
                    }
                    return {
                        labels: Object.keys(wordsData),
                        datasets: [{
                            label: 'Frequency',
                            data: Object.values(wordsData),
                            backgroundColor: chartColors.secondary,
                            borderRadius: 6
                        }]
                    };
                
                case 'severity':
                    const severityData = {{ dashboard_data.pattern_data.severity_levels | tojson }};
                    return {
                        labels: Object.keys(severityData),
                        datasets: [{
                            data: Object.values(severityData),
                            backgroundColor: [
                                chartColors.danger,
                                chartColors.warning,
                                chartColors.info,
                                chartColors.light
                            ],
                            borderWidth: 0,
                            hoverOffset: 4
                        }]
                    };
                
                case 'timeline':
                    const dailyData = {{ dashboard_data.time_data.daily_distribution | tojson if dashboard_data.time_data.daily_distribution else '{}' }};
                    const dailyAnomalies = {{ dashboard_data.time_data.daily_anomalies | tojson if dashboard_data.time_data.daily_anomalies else '{}' }};
                    const timelineData = Object.keys(dailyData).map((day, index) => ({
                        x: index,
                        y: dailyAnomalies[day] || 0,
                        label: day  // Add date label for tooltips
                    }));
                    return {
                        datasets: [{
                            label: 'Anomalies',
                            data: timelineData,
                            backgroundColor: chartColors.danger,
                            borderColor: chartColors.danger,
                            pointRadius: 4
                        }]
                    };
                
                default:
                    return { labels: [], datasets: [] };
            }
        }

        // Initialize all charts
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ðŸš€ Initializing dashboard charts...');
            
            try {
                // Initialize anomaly chart
                const anomalyCtx = document.getElementById('anomalyChart');
                if (anomalyCtx) {
                    console.log('ðŸ“Š Initializing anomaly chart...');
                    charts.anomaly = new Chart(anomalyCtx, getChartConfig('anomaly', 'doughnut'));
                    console.log('âœ… Anomaly chart initialized');
                } else {
                    console.warn('âš ï¸ Anomaly chart canvas not found');
                }

                // Initialize error chart
                const errorCtx = document.getElementById('errorChart');
                if (errorCtx) {
                    console.log('ðŸ“Š Initializing error chart...');
                    charts.error = new Chart(errorCtx, getChartConfig('error', 'pie'));
                    console.log('âœ… Error chart initialized');
                } else {
                    console.warn('âš ï¸ Error chart canvas not found');
                }

                // Initialize hourly chart
                const hourlyCtx = document.getElementById('hourlyChart');
                if (hourlyCtx) {
                    console.log('ðŸ“Š Initializing hourly chart...');
                    charts.hourly = new Chart(hourlyCtx, getChartConfig('hourly', 'bar'));
                    console.log('âœ… Hourly chart initialized');
                } else {
                    console.warn('âš ï¸ Hourly chart canvas not found');
                }

                // Initialize words chart
                const wordsCtx = document.getElementById('wordsChart');
                if (wordsCtx) {
                    console.log('ðŸ“Š Initializing words chart...');
                    charts.words = new Chart(wordsCtx, getChartConfig('words', 'horizontalBar'));
                    console.log('âœ… Words chart initialized');
                } else {
                    console.warn('âš ï¸ Words chart canvas not found');
                }

                // Initialize severity chart
                const severityCtx = document.getElementById('severityChart');
                if (severityCtx) {
                    console.log('ðŸ“Š Initializing severity chart...');
                    charts.severity = new Chart(severityCtx, getChartConfig('severity', 'pie'));
                    console.log('âœ… Severity chart initialized');
                } else {
                    console.warn('âš ï¸ Severity chart canvas not found');
                }

                // Initialize timeline chart
                const timelineCtx = document.getElementById('timelineChart');
                if (timelineCtx) {
                    console.log('ðŸ“Š Initializing timeline chart...');
                    charts.timeline = new Chart(timelineCtx, getChartConfig('timeline', 'line'));
                    console.log('âœ… Timeline chart initialized');
                } else {
                    console.warn('âš ï¸ Timeline chart canvas not found');
                }
                
                console.log('ðŸŽ‰ All charts initialized successfully!');
            } catch (error) {
                console.error('âŒ Error initializing charts:', error);
            }
        });

        // Handle window resize for responsive charts
        window.addEventListener('resize', function() {
            Object.values(charts).forEach(chart => {
                if (chart) {
                    chart.resize();
                }
            });
        });
    </script>
</body>
</html> 